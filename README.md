# Управление офферами

## Описание проекта

Это мини-приложение для управления офферами, разработанное в рамках тестового задания. Приложение позволяет создавать, редактировать, удалять и просматривать офферы в CRM-панели.

## Функциональность

- Создание, редактирование и удаление офферов.
- Отображение списка офферов с возможностью сортировки по ID и названию оффера.
- Фильтрация списка по названию оффера и email представителя с использованием AJAX-запросов.
- Пагинация списка офферов (по 10 записей на страницу).
- Валидация данных на клиенте и сервере.
- Уведомления об успешных операциях и ошибках валидации.

## Требования

- PHP 7.4 или выше
- MySQL
- Веб-сервер (Apache или Nginx)
- Composer
- Yii 2 Basic Application Template

## Установка и запуск проекта локально

### 1. Клонирование репозитория

```bash
git clone https://github.com/denisAtm/offers-management.git
```

### 2. Установка зависимостей

Перейдите в директорию проекта и выполните команду для установки зависимостей:

```bash
cd offers-management
composer install
```

### 3. Настройка базы данных

- Создайте базу данных `offers_db\.

- Импортируйте структуру таблицы и тестовые данные из файла \`schema.sql\` или используйте следующий SQL-скрипт:

```sql
CREATE DATABASE offers_db CHARACTER SET utf8 COLLATE utf8_general_ci;

USE offers_db;

CREATE TABLE `offers` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `offer_name` VARCHAR(255) NOT NULL,
  `representative_email` VARCHAR(255) NOT NULL,
  `representative_phone` VARCHAR(255) DEFAULT NULL,
  `date_added` DATETIME NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `representative_email` (`representative_email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- Добавление тестовых данных
INSERT INTO `offers` (`offer_name`, `representative_email`, `representative_phone`, `date_added`) VALUES
('Оффер 1', 'email1@example.com', '1234567890', NOW()),
('Оффер 2', 'email2@example.com', '0987654321', NOW()),
('Оффер 3', 'email3@example.com', '5555555555', NOW()),
('Оффер 4', 'email4@example.com', '4444444444', NOW()),
('Оффер 5', 'email5@example.com', '3333333333', NOW()),
('Оффер 6', 'email6@example.com', '2222222222', NOW()),
('Оффер 7', 'email7@example.com', '1111111111', NOW()),
('Оффер 8', 'email8@example.com', '6666666666', NOW()),
('Оффер 9', 'email9@example.com', '7777777777', NOW()),
('Оффер 10', 'email10@example.com', '8888888888', NOW()),
('Оффер 11', 'email11@example.com', '9999999999', NOW()),
('Оффер 12', 'email12@example.com', '0000000000', NOW()),
('Оффер 13', 'email13@example.com', NULL, NOW()),
('Оффер 14', 'email14@example.com', NULL, NOW()),
('Оффер 15', 'email15@example.com', NULL, NOW());
```

### 4. Настройка приложения

- В файле \`config/db.php\` укажите параметры подключения к базе данных:

```
return [
    'class' => 'yii\\db\\Connection',
    'dsn' => 'mysql:host=localhost;dbname=offers_db',
    'username' => 'your_db_username',
    'password' => 'your_db_password',
    'charset' => 'utf8',
];
```

- В файле \`config/web.php\` убедитесь, что включен компонент \`urlManager\`:

```
'urlManager' => [
    'enablePrettyUrl' => true,
    'showScriptName' => false,
    'rules' => [
        'offers' => 'offer/index',
        'offer/create' => 'offer/create',
        'offer/update/<id:\\d+>' => 'offer/update',
        'offer/delete/<id:\\d+>' => 'offer/delete',
        'offer/validate-form' => 'offer/validate-form',
    ],
],
```

### 5. Запуск приложения

- Используя встроенный PHP-сервер Yii, выполните команду:

```
php yii serve --port=8080
```

Приложение будет доступно по адресу `http://localhost:8080`.

### 6. Проверка работы

Перейдите в браузере по адресу:

```
http://localhost:8080/offers
```

Вы должны увидеть список офферов и иметь возможность выполнять CRUD-операции.

## Архитектурные решения

### Использование Yii 2 и архитектуры MVC

Для разработки приложения я выбрал фреймворк Yii 2, который поддерживает архитектуру MVC. Это позволило четко разделить логику приложения, представления и модели данных, что облегчает поддержку и масштабирование проекта.

### Модели

- **Offer**: Представляет таблицу `offers` в базе данных. В модели определены правила валидации, такие как обязательность полей, уникальность email и проверка формата email. Также в модели реализовано автоматическое заполнение поля `date_added` при создании записи.

### Контроллеры

- **OfferController**: Обрабатывает запросы пользователя и взаимодействует с моделью `Offer`. Реализует действия для создания, чтения, обновления и удаления офферов. Использует методы для AJAX-валидации и обработки запросов без перезагрузки страницы.

### Представления

- Используются представления для отображения форм и списков офферов. Применены компоненты Yii 2, такие как `GridView`, `ActiveForm\`, а также модальные окна для создания и редактирования офферов.

### AJAX и модальные окна

- Для улучшения пользовательского опыта использованы AJAX-запросы с помощью JQuery. Создание и редактирование офферов происходит в модальных окнах без перезагрузки страницы, что делает взаимодействие с приложением более плавным и удобным.

### Валидация данных

- Реализована как клиентская, так и серверная валидация с использованием возможностей Yii 2. Это обеспечивает надежность данных и удобство для пользователя, предоставляя мгновенную обратную связь при вводе информации.

### Пагинация и фильтрация

- Список офферов разбит на страницы по 10 записей с возможностью сортировки и фильтрации по определенным полям. Это реализовано с помощью `ActiveDataProvider` и Pjax для обновления данных без перезагрузки страницы.
